<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>celery.worker.consumer &mdash; Celery 2.6.0rc4 documentation</title>
    
    <link rel="stylesheet" href="../../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/issuetracker.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.6.0rc4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Celery 2.6.0rc4 documentation" href="../../index.html" />
    <link rel="up" title="Internal Module Reference" href="index.html" />
    <link rel="next" title="celery.worker.job" href="celery.worker.job.html" />
    <link rel="prev" title="celery.worker" href="celery.worker.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="celery.worker.job.html" title="celery.worker.job"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="celery.worker.html" title="celery.worker"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Celery 2.6.0rc4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Internals</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Internal Module Reference</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
<div class="deck">

    <h2>Development documentation has MOVED!</h2>
    <p>
    Go to the
    <a href="http://celery.github.com/celery/internals/reference/celery.worker.consumer.html">new location for this page</a>.

</div>
    <div class="section" id="celery-worker-consumer">
<h1>celery.worker.consumer<a class="headerlink" href="#celery-worker-consumer" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id2">celery.worker.consumer</a></li>
</ul>
</div>
<span class="target" id="module-celery.worker.consumer"></span><div class="section" id="id1">
<h2><a class="toc-backref" href="#id2">celery.worker.consumer</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>This module contains the component responsible for consuming messages
from the broker, processing the messages and keeping the broker connections
up and running.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">copyright:</th><td class="field-body"><ol class="first loweralpha simple" start="3">
<li>2009 - 2012 by Ask Solem.</li>
</ol>
</td>
</tr>
<tr class="field-even field"><th class="field-name">license:</th><td class="field-body"><p class="first last">BSD, see LICENSE for more details.</p>
</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first"><a class="reference internal" href="#celery.worker.consumer.Consumer.start" title="celery.worker.consumer.Consumer.start"><tt class="xref py py-meth docutils literal"><span class="pre">start()</span></tt></a> is an infinite loop, which only iterates
again if the connection is lost. For each iteration (at start, or if the
connection is lost) it calls <a class="reference internal" href="#celery.worker.consumer.Consumer.reset_connection" title="celery.worker.consumer.Consumer.reset_connection"><tt class="xref py py-meth docutils literal"><span class="pre">reset_connection()</span></tt></a>,
and starts the consumer by calling <a class="reference internal" href="#celery.worker.consumer.Consumer.consume_messages" title="celery.worker.consumer.Consumer.consume_messages"><tt class="xref py py-meth docutils literal"><span class="pre">consume_messages()</span></tt></a>.</p>
</li>
<li><p class="first"><a class="reference internal" href="#celery.worker.consumer.Consumer.reset_connection" title="celery.worker.consumer.Consumer.reset_connection"><tt class="xref py py-meth docutils literal"><span class="pre">reset_connection()</span></tt></a>, clears the internal queues,
establishes a new connection to the broker, sets up the task
consumer (+ QoS), and the broadcast remote control command consumer.</p>
<p>Also if events are enabled it configures the event dispatcher and starts
up the heartbeat thread.</p>
</li>
<li><p class="first">Finally it can consume messages. <a class="reference internal" href="#celery.worker.consumer.Consumer.consume_messages" title="celery.worker.consumer.Consumer.consume_messages"><tt class="xref py py-meth docutils literal"><span class="pre">consume_messages()</span></tt></a>
is simply an infinite loop waiting for events on the AMQP channels.</p>
<p>Both the task consumer and the broadcast consumer uses the same
callback: <a class="reference internal" href="#celery.worker.consumer.Consumer.receive_message" title="celery.worker.consumer.Consumer.receive_message"><tt class="xref py py-meth docutils literal"><span class="pre">receive_message()</span></tt></a>.</p>
</li>
<li><p class="first">So for each message received the <a class="reference internal" href="#celery.worker.consumer.Consumer.receive_message" title="celery.worker.consumer.Consumer.receive_message"><tt class="xref py py-meth docutils literal"><span class="pre">receive_message()</span></tt></a>
method is called, this checks the payload of the message for either
a <cite>task</cite> key or a <cite>control</cite> key.</p>
<p>If the message is a task, it verifies the validity of the message
converts it to a <a class="reference internal" href="celery.worker.job.html#celery.worker.job.Request" title="celery.worker.job.Request"><tt class="xref py py-class docutils literal"><span class="pre">celery.worker.job.Request</span></tt></a>, and sends
it to <a class="reference internal" href="#celery.worker.consumer.Consumer.on_task" title="celery.worker.consumer.Consumer.on_task"><tt class="xref py py-meth docutils literal"><span class="pre">on_task()</span></tt></a>.</p>
<p>If the message is a control command the message is passed to
<a class="reference internal" href="#celery.worker.consumer.Consumer.on_control" title="celery.worker.consumer.Consumer.on_control"><tt class="xref py py-meth docutils literal"><span class="pre">on_control()</span></tt></a>, which in turn dispatches
the control command using the control dispatcher.</p>
<p>It also tries to handle malformed or invalid messages properly,
so the worker doesn&#8217;t choke on them and die. Any invalid messages
are acknowledged immediately and logged, so the message is not resent
again, and again.</p>
</li>
<li><p class="first">If the task has an ETA/countdown, the task is moved to the <cite>timer</cite>
so the <tt class="xref py py-class docutils literal"><span class="pre">timer2.Timer</span></tt> can schedule it at its
deadline. Tasks without an eta are moved immediately to the <cite>ready_queue</cite>,
so they can be picked up by the <a class="reference internal" href="celery.worker.mediator.html#celery.worker.mediator.Mediator" title="celery.worker.mediator.Mediator"><tt class="xref py py-class docutils literal"><span class="pre">Mediator</span></tt></a>
to be sent to the pool.</p>
</li>
<li><p class="first">When a task with an ETA is received the QoS prefetch count is also
incremented, so another message can be reserved. When the ETA is met
the prefetch count is decremented again, though this cannot happen
immediately because amqplib doesn&#8217;t support doing broker requests
across threads. Instead the current prefetch count is kept as a
shared counter, so as soon as  <a class="reference internal" href="#celery.worker.consumer.Consumer.consume_messages" title="celery.worker.consumer.Consumer.consume_messages"><tt class="xref py py-meth docutils literal"><span class="pre">consume_messages()</span></tt></a>
detects that the value has changed it will send out the actual
QoS event to the broker.</p>
</li>
<li><p class="first">Notice that when the connection is lost all internal queues are cleared
because we can no longer ack the messages reserved in memory.
However, this is not dangerous as the broker will resend them
to another worker when the channel is closed.</p>
</li>
<li><p class="first"><strong>WARNING</strong>: <a class="reference internal" href="#celery.worker.consumer.Consumer.stop" title="celery.worker.consumer.Consumer.stop"><tt class="xref py py-meth docutils literal"><span class="pre">stop()</span></tt></a> does not close the connection!
This is because some pre-acked messages may be in processing,
and they need to be finished before the channel is closed.
For celeryd this means the pool must finish the tasks it has acked
early, <em>then</em> close the connection.</p>
</li>
</ul>
<dl class="class">
<dt id="celery.worker.consumer.BlockingConsumer">
<em class="property">class </em><tt class="descclassname">celery.worker.consumer.</tt><tt class="descname">BlockingConsumer</tt><big>(</big><em>ready_queue</em>, <em>init_callback=&lt;function noop at 0x10193e6e0&gt;</em>, <em>send_events=False</em>, <em>hostname=None</em>, <em>initial_prefetch_count=2</em>, <em>pool=None</em>, <em>app=None</em>, <em>timer=None</em>, <em>controller=None</em>, <em>hub=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.BlockingConsumer" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="celery.worker.consumer.BlockingConsumer.consume_messages">
<tt class="descname">consume_messages</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.worker.consumer.BlockingConsumer.consume_messages" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="celery.worker.consumer.Component">
<em class="property">class </em><tt class="descclassname">celery.worker.consumer.</tt><tt class="descname">Component</tt><big>(</big><em>parent</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Component" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="celery.worker.consumer.Component.Consumer">
<tt class="descname">Consumer</tt><big>(</big><em>w</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Component.Consumer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Component.create">
<tt class="descname">create</tt><big>(</big><em>w</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Component.create" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Component.last">
<tt class="descname">last</tt><em class="property"> = True</em><a class="headerlink" href="#celery.worker.consumer.Component.last" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Component.name">
<tt class="descname">name</tt><em class="property"> = 'consumer'</em><a class="headerlink" href="#celery.worker.consumer.Component.name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Component.namespace">
<tt class="descname">namespace</tt><em class="property"> = 'worker'</em><a class="headerlink" href="#celery.worker.consumer.Component.namespace" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="celery.worker.consumer.Consumer">
<em class="property">class </em><tt class="descclassname">celery.worker.consumer.</tt><tt class="descname">Consumer</tt><big>(</big><em>ready_queue</em>, <em>init_callback=&lt;function noop at 0x10193e6e0&gt;</em>, <em>send_events=False</em>, <em>hostname=None</em>, <em>initial_prefetch_count=2</em>, <em>pool=None</em>, <em>app=None</em>, <em>timer=None</em>, <em>controller=None</em>, <em>hub=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer" title="Permalink to this definition">¶</a></dt>
<dd><p>Listen for messages received from the broker and
move them to the ready queue for task processing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ready_queue</strong> &#8211; See <a class="reference internal" href="#celery.worker.consumer.Consumer.ready_queue" title="celery.worker.consumer.Consumer.ready_queue"><tt class="xref py py-attr docutils literal"><span class="pre">ready_queue</span></tt></a>.</li>
<li><strong>timer</strong> &#8211; See <a class="reference internal" href="#celery.worker.consumer.Consumer.timer" title="celery.worker.consumer.Consumer.timer"><tt class="xref py py-attr docutils literal"><span class="pre">timer</span></tt></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="celery.worker.consumer.Consumer.apply_eta_task">
<tt class="descname">apply_eta_task</tt><big>(</big><em>task</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.apply_eta_task" title="Permalink to this definition">¶</a></dt>
<dd><p>Method called by the timer to apply a task with an
ETA/countdown.</p>
</dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.broadcast_consumer">
<tt class="descname">broadcast_consumer</tt><em class="property"> = None</em><a class="headerlink" href="#celery.worker.consumer.Consumer.broadcast_consumer" title="Permalink to this definition">¶</a></dt>
<dd><p>The consumer used to consume broadcast commands.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.close">
<tt class="descname">close</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.close" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.close_connection">
<tt class="descname">close_connection</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.close_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Closes the current broker connection and all open channels.</p>
</dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.connection">
<tt class="descname">connection</tt><em class="property"> = None</em><a class="headerlink" href="#celery.worker.consumer.Consumer.connection" title="Permalink to this definition">¶</a></dt>
<dd><p>The broker connection.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.consume_messages">
<tt class="descname">consume_messages</tt><big>(</big><em>sleep=&lt;built-in function sleep&gt;</em>, <em>min=&lt;built-in function min&gt;</em>, <em>Empty=&lt;class 'Queue.Empty'&gt;</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.consume_messages" title="Permalink to this definition">¶</a></dt>
<dd><p>Consume messages forever (or until an exception is raised).</p>
</dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.event_dispatcher">
<tt class="descname">event_dispatcher</tt><em class="property"> = None</em><a class="headerlink" href="#celery.worker.consumer.Consumer.event_dispatcher" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="../../reference/celery.events.html#celery.events.EventDispatcher" title="celery.events.EventDispatcher"><tt class="xref py py-class docutils literal"><span class="pre">celery.events.EventDispatcher</span></tt></a> for sending events.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.handle_invalid_task">
<tt class="descname">handle_invalid_task</tt><big>(</big><em>body</em>, <em>message</em>, <em>exc</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.handle_invalid_task" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.handle_unknown_message">
<tt class="descname">handle_unknown_message</tt><big>(</big><em>body</em>, <em>message</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.handle_unknown_message" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.handle_unknown_task">
<tt class="descname">handle_unknown_task</tt><big>(</big><em>body</em>, <em>message</em>, <em>exc</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.handle_unknown_task" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.heart">
<tt class="descname">heart</tt><em class="property"> = None</em><a class="headerlink" href="#celery.worker.consumer.Consumer.heart" title="Permalink to this definition">¶</a></dt>
<dd><p>The thread that sends event heartbeats at regular intervals.
The heartbeats are used by monitors to detect that a worker
went offline/disappeared.</p>
</dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.hostname">
<tt class="descname">hostname</tt><em class="property"> = None</em><a class="headerlink" href="#celery.worker.consumer.Consumer.hostname" title="Permalink to this definition">¶</a></dt>
<dd><p>The current hostname.  Defaults to the system hostname.</p>
</dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.info">
<tt class="descname">info</tt><a class="headerlink" href="#celery.worker.consumer.Consumer.info" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns information about this consumer instance
as a dict.</p>
<p>This is also the consumer related info returned by
<tt class="docutils literal"><span class="pre">celeryctl</span> <span class="pre">stats</span></tt>.</p>
</dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.init_callback">
<tt class="descname">init_callback</tt><em class="property"> = None</em><a class="headerlink" href="#celery.worker.consumer.Consumer.init_callback" title="Permalink to this definition">¶</a></dt>
<dd><p>Optional callback to be called when the connection is established.
Will only be called once, even if the connection is lost and
re-established.</p>
</dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.initial_prefetch_count">
<tt class="descname">initial_prefetch_count</tt><em class="property"> = 0</em><a class="headerlink" href="#celery.worker.consumer.Consumer.initial_prefetch_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Initial QoS prefetch count for the task channel.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.maybe_conn_error">
<tt class="descname">maybe_conn_error</tt><big>(</big><em>fun</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.maybe_conn_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies function but ignores any connection or channel
errors raised.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.maybe_shutdown">
<tt class="descname">maybe_shutdown</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.maybe_shutdown" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.on_control">
<tt class="descname">on_control</tt><big>(</big><em>body</em>, <em>message</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.on_control" title="Permalink to this definition">¶</a></dt>
<dd><p>Process remote control command message.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.on_decode_error">
<tt class="descname">on_decode_error</tt><big>(</big><em>message</em>, <em>exc</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.on_decode_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Callback called if an error occurs while decoding
a message received.</p>
<p>Simply logs the error and acknowledges the message so it
doesn&#8217;t enter a loop.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>message</strong> &#8211; The message with errors.</li>
<li><strong>exc</strong> &#8211; The original exception instance.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.on_poll_init">
<tt class="descname">on_poll_init</tt><big>(</big><em>hub</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.on_poll_init" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.on_task">
<tt class="descname">on_task</tt><big>(</big><em>task</em>, <em>task_reserved=&lt;built-in method add of set object at 0x104ed8220&gt;</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.on_task" title="Permalink to this definition">¶</a></dt>
<dd><p>Handle received task.</p>
<p>If the task has an <cite>eta</cite> we enter it into the ETA schedule,
otherwise we move it the ready queue for immediate processing.</p>
</dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.pidbox_node">
<tt class="descname">pidbox_node</tt><em class="property"> = None</em><a class="headerlink" href="#celery.worker.consumer.Consumer.pidbox_node" title="Permalink to this definition">¶</a></dt>
<dd><p>The process mailbox (kombu pidbox node).</p>
</dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.pool">
<tt class="descname">pool</tt><em class="property"> = None</em><a class="headerlink" href="#celery.worker.consumer.Consumer.pool" title="Permalink to this definition">¶</a></dt>
<dd><p>The current worker pool instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.ready_queue">
<tt class="descname">ready_queue</tt><em class="property"> = None</em><a class="headerlink" href="#celery.worker.consumer.Consumer.ready_queue" title="Permalink to this definition">¶</a></dt>
<dd><p>The queue that holds tasks ready for immediate processing.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.receive_message">
<tt class="descname">receive_message</tt><big>(</big><em>body</em>, <em>message</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.receive_message" title="Permalink to this definition">¶</a></dt>
<dd><p>Handles incoming messages.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>body</strong> &#8211; The message body.</li>
<li><strong>message</strong> &#8211; The kombu message object.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.reset_connection">
<tt class="descname">reset_connection</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.reset_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Re-establish the broker connection and set up consumers,
heartbeat and the event dispatcher.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.reset_pidbox_node">
<tt class="descname">reset_pidbox_node</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.reset_pidbox_node" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets up the process mailbox.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.restart_heartbeat">
<tt class="descname">restart_heartbeat</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.restart_heartbeat" title="Permalink to this definition">¶</a></dt>
<dd><p>Restart the heartbeat thread.</p>
<p>This thread sends heartbeat events at intervals so monitors
can tell if the worker is off-line/missing.</p>
</dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.send_events">
<tt class="descname">send_events</tt><em class="property"> = False</em><a class="headerlink" href="#celery.worker.consumer.Consumer.send_events" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable/disable events.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.start">
<tt class="descname">start</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the consumer.</p>
<p>Automatically survives intermittent connection failure,
and will retry establishing the connection and restart
consuming messages.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.stop">
<tt class="descname">stop</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop consuming.</p>
<p>Does not close the broker connection, so be sure to call
<a class="reference internal" href="#celery.worker.consumer.Consumer.close_connection" title="celery.worker.consumer.Consumer.close_connection"><tt class="xref py py-meth docutils literal"><span class="pre">close_connection()</span></tt></a> when you are finished with it.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.stop_consumers">
<tt class="descname">stop_consumers</tt><big>(</big><em>close_connection=True</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.stop_consumers" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop consuming tasks and broadcast commands, also stops
the heartbeat thread and event dispatcher.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>close_connection</strong> &#8211; Set to False to skip closing the broker
connection.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.stop_pidbox_node">
<tt class="descname">stop_pidbox_node</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.stop_pidbox_node" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.task_consumer">
<tt class="descname">task_consumer</tt><em class="property"> = None</em><a class="headerlink" href="#celery.worker.consumer.Consumer.task_consumer" title="Permalink to this definition">¶</a></dt>
<dd><p>The consumer used to consume task messages.</p>
</dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.Consumer.timer">
<tt class="descname">timer</tt><em class="property"> = None</em><a class="headerlink" href="#celery.worker.consumer.Consumer.timer" title="Permalink to this definition">¶</a></dt>
<dd><p>A timer used for high-priority internal tasks, such
as sending heartbeats.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.Consumer.update_strategies">
<tt class="descname">update_strategies</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.worker.consumer.Consumer.update_strategies" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="data">
<dt id="celery.worker.consumer.INVALID_TASK_ERROR">
<tt class="descclassname">celery.worker.consumer.</tt><tt class="descname">INVALID_TASK_ERROR</tt><em class="property"> = 'Received invalid task message: %s\nThe message has been ignored and discarded.\n\nPlease ensure your message conforms to the task\nmessage protocol as described here: http://bit.ly/hYj41y\n\nThe full contents of the message body was:\n%s\n'</em><a class="headerlink" href="#celery.worker.consumer.INVALID_TASK_ERROR" title="Permalink to this definition">¶</a></dt>
<dd><p>Error message for when an invalid task message is received.</p>
</dd></dl>

<dl class="data">
<dt id="celery.worker.consumer.PREFETCH_COUNT_MAX">
<tt class="descclassname">celery.worker.consumer.</tt><tt class="descname">PREFETCH_COUNT_MAX</tt><em class="property"> = 65535</em><a class="headerlink" href="#celery.worker.consumer.PREFETCH_COUNT_MAX" title="Permalink to this definition">¶</a></dt>
<dd><p>Prefetch count can&#8217;t exceed short.</p>
</dd></dl>

<dl class="class">
<dt id="celery.worker.consumer.QoS">
<em class="property">class </em><tt class="descclassname">celery.worker.consumer.</tt><tt class="descname">QoS</tt><big>(</big><em>consumer</em>, <em>initial_value</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.QoS" title="Permalink to this definition">¶</a></dt>
<dd><p>Quality of Service for Channel.</p>
<p>For thread-safe increment/decrement of a channels prefetch count value.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>consumer</strong> &#8211; A <a class="reference external" href="http://kombu.readthedocs.org/en/latest/reference/kombu.messaging.html#kombu.messaging.Consumer" title="(in Kombu v2.2)"><tt class="xref py py-class docutils literal"><span class="pre">kombu.messaging.Consumer</span></tt></a> instance.</li>
<li><strong>initial_value</strong> &#8211; Initial prefetch count value.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="celery.worker.consumer.QoS.decrement">
<tt class="descname">decrement</tt><big>(</big><em>n=1</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.QoS.decrement" title="Permalink to this definition">¶</a></dt>
<dd><p>Decrement the current prefetch count value by n.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.QoS.decrement_eventually">
<tt class="descname">decrement_eventually</tt><big>(</big><em>n=1</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.QoS.decrement_eventually" title="Permalink to this definition">¶</a></dt>
<dd><p>Decrement the value, but do not update the qos.</p>
<p>The MainThread will be responsible for calling <a class="reference internal" href="#celery.worker.consumer.QoS.update" title="celery.worker.consumer.QoS.update"><tt class="xref py py-meth docutils literal"><span class="pre">update()</span></tt></a>
when necessary.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.QoS.increment">
<tt class="descname">increment</tt><big>(</big><em>n=1</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.QoS.increment" title="Permalink to this definition">¶</a></dt>
<dd><p>Increment the current prefetch count value by n.</p>
</dd></dl>

<dl class="attribute">
<dt id="celery.worker.consumer.QoS.prev">
<tt class="descname">prev</tt><em class="property"> = None</em><a class="headerlink" href="#celery.worker.consumer.QoS.prev" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.QoS.set">
<tt class="descname">set</tt><big>(</big><em>pcount</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.QoS.set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set channel prefetch_count setting.</p>
</dd></dl>

<dl class="method">
<dt id="celery.worker.consumer.QoS.update">
<tt class="descname">update</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.worker.consumer.QoS.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update prefetch count with current value.</p>
</dd></dl>

</dd></dl>

<dl class="data">
<dt id="celery.worker.consumer.UNKNOWN_TASK_ERROR">
<tt class="descclassname">celery.worker.consumer.</tt><tt class="descname">UNKNOWN_TASK_ERROR</tt><em class="property"> = 'Received unregistered task of type %s.\nThe message has been ignored and discarded.\n\nDid you remember to import the module containing this task?\nOr maybe you are using relative imports?\nPlease see http://bit.ly/gLye1c for more information.\n\nThe full contents of the message body was:\n%s\n'</em><a class="headerlink" href="#celery.worker.consumer.UNKNOWN_TASK_ERROR" title="Permalink to this definition">¶</a></dt>
<dd><p>Error message for when an unregistered task is received.</p>
</dd></dl>

<dl class="function">
<dt id="celery.worker.consumer.debug">
<tt class="descclassname">celery.worker.consumer.</tt><tt class="descname">debug</tt><big>(</big><em>msg</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#celery.worker.consumer.debug" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="celery.worker.consumer.task_reserved">
<tt class="descclassname">celery.worker.consumer.</tt><tt class="descname">task_reserved</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.worker.consumer.task_reserved" title="Permalink to this definition">¶</a></dt>
<dd><p>Add an element to a set.</p>
<p>This has no effect if the element is already present.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="../../index.html">
  <img class="logo" src="http://cloud.github.com/downloads/ask/celery/celery_128.png" alt="Logo"/>
</a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="celery.worker.html"
                        title="previous chapter">celery.worker</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="celery.worker.job.html"
                        title="next chapter">celery.worker.job</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/internals/reference/celery.worker.consumer.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="celery.worker.job.html" title="celery.worker.job"
             >next</a> |</li>
        <li class="right" >
          <a href="celery.worker.html" title="celery.worker"
             >previous</a> |</li>
        <li><a href="../../index.html">Celery 2.6.0rc4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Internals</a> &raquo;</li>
          <li><a href="index.html" >Internal Module Reference</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2012, Ask Solem &amp; Contributors.
    </div>
  </body>
</html>